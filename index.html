<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Analysis Framework - Cost-Effective Multimodal AI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #000;
            background: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: #000;
            color: #fff;
            padding: 6px 0 4px;
            border-bottom: 4px solid #000;
        }

        h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 15px;
            letter-spacing: -1px;
        }

        .subtitle {
            font-size: 20px;
            color: #ccc;
            margin-bottom: 30px;
        }

        .stats-bar {
            display: flex;
            gap: 40px;
            font-size: 15px;
            flex-wrap: wrap;
        }

        .stat {
            font-weight: 600;
        }

        .stat strong {
            font-weight: 700;
            font-size: 24px;
            display: block;
            margin-bottom: 5px;
        }

        .contact-sheet-thumb {
            max-width: 150px;
            height: auto;
            display: block;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .contact-sheet-thumb:hover {
            transform: scale(1.05);
            border-color: #000;
        }

        /* Navigation */
        nav {
            background: #f9f9f9;
            border-bottom: 2px solid #000;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 30px;
            padding: 15px 20px;
        }

        nav a {
            text-decoration: none;
            color: #000;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        nav a:hover {
            text-decoration: underline;
        }

        /* Sections */
        section {
            padding: 60px 0;
            border-bottom: 2px solid #e0e0e0;
        }

        h2 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -0.5px;
        }

        h3 {
            font-size: 24px;
            font-weight: 600;
            margin: 40px 0 20px;
        }

        h4 {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 0 10px;
        }

        p {
            margin-bottom: 15px;
            line-height: 1.8;
        }

        /* Key Insights Cards */
        .insight-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .insight-card {
            background: #f9f9f9;
            border: 3px solid #000;
            padding: 30px;
        }

        .insight-card h4 {
            font-size: 20px;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-card .icon {
            font-size: 32px;
        }

        .insight-card ul {
            margin-left: 20px;
            line-height: 2;
        }

        /* Pipeline Diagram */
        .pipeline {
            background: #f9f9f9;
            border: 3px solid #000;
            padding: 40px;
            margin: 40px 0;
            overflow-x: auto;
        }

        .pipeline-flow {
            display: flex;
            align-items: center;
            gap: 20px;
            min-width: 1200px;
        }

        .pipeline-step {
            flex: 1;
            background: #fff;
            border: 2px solid #000;
            padding: 20px;
            text-align: center;
        }

        .pipeline-step .step-num {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 10px;
            color: #666;
        }

        .pipeline-step .step-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .pipeline-step .step-detail {
            font-size: 12px;
            color: #666;
        }

        .pipeline-arrow {
            font-size: 24px;
            font-weight: 700;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #000;
            background: #fff;
            font-size: 13px;
            margin: 20px 0;
        }

        .data-table thead {
            background: #000;
            color: #fff;
        }

        .data-table th {
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        .data-table td {
            padding: 12px 10px;
            border-top: 1px solid #ddd;
            vertical-align: top;
        }

        /* Make the Take column easier to read */
        .data-table td:nth-child(3) {
            font-size: 15px;
            font-weight: 500;
            line-height: 1.5;
        }

        .data-table tbody tr:hover {
            background: #f5f5f5;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-group label {
            display: block;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 5px;
            letter-spacing: 0.5px;
        }

        select,
        input {
            padding: 10px 12px;
            border: 2px solid #000;
            background: #fff;
            font-family: inherit;
            font-size: 14px;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        .charts-grid.fade-out {
            opacity: 0;
        }

        #word-cloud {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        #word-cloud.fade-out {
            opacity: 0;
        }

        .chart-container {
            border: 2px solid #000;
            padding: 20px;
            background: #f9f9f9;
        }

        .chart-container h4 {
            margin: 0 0 12px 0;
            font-size: 16px;
        }

        /* Badges */
        .video-link {
            display: inline-block;
            padding: 10px 18px;
            background: #000;
            color: #fff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            border-radius: 2px;
            transition: all 0.2s;
        }

        .video-link:hover {
            background: #333;
            transform: scale(1.05);
        }

        .model-response {
            font-size: 28px;
            font-weight: 700;
            cursor: help;
            border: none !important;
            background: none !important;
            background-color: transparent !important;
            outline: none !important;
            box-shadow: none !important;
        }

        .model-response.agree {
            color: #000;
        }

        .model-response.disagree {
            color: #999;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .tag {
            background: #000;
            color: #fff;
            padding: 4px 8px;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 500;
            display: inline-block;
            margin: 2px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            border: 2px solid #000;
            padding: 25px;
            text-align: center;
            background: #fff;
        }

        .stat-value {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            color: #666;
            font-weight: 600;
        }

        /* Footer */
        footer {
            background: #000;
            color: #fff;
            padding: 40px 0;
            text-align: center;
            font-size: 14px;
        }

        code {
            background: #f0f0f0;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 16px;
            color: #666;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            overflow: auto;
        }

        .modal-content {
            background-color: #fff;
            margin: 2% auto;
            padding: 0;
            max-width: 1200px;
            width: 90%;
            border-radius: 4px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            padding: 20px 30px;
            background: #000;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px 4px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 24px;
        }

        .modal-close {
            color: #fff;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
        }

        .modal-close:hover {
            color: #ccc;
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-image {
            width: 100%;
            height: auto;
            margin-bottom: 30px;
            border: 1px solid #ddd;
        }

        .modal-section {
            margin-bottom: 30px;
        }

        .modal-section h4 {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #000;
        }

        .model-response {
            background: #f5f5f5;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #000;
        }

        .model-response h5 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        /* Responsive grid for model responses on large screens */
        @media (min-width: 1024px) {
            .model-responses-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .model-responses-grid .model-response {
                margin-bottom: 0;
            }
        }

        .json-display {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Responsive: Stack components vertically on mobile */
        @media (max-width: 768px) {
            .components-grid {
                grid-template-columns: 1fr !important;
            }
        }

        /* Filter buttons */
        .filter-btn {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid #ddd;
            background: white;
            color: #666;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: #000;
            color: #000;
        }

        .filter-btn.active {
            background: #000;
            color: white;
            border-color: #000;
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <h1>SubwayTakes Analysis</h1>
            <div class="subtitle">100 YouTube Shorts analyzed with multimodal AI</div>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="#explorer">Data Explorer</a></li>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#insights">Key Findings</a></li>
            <li><a href="#methodology">How It Works</a></li>
            <li><a href="#framework">Technical Details</a></li>
        </ul>
    </nav>

    <!-- DATA EXPLORER -->
    <section id="explorer">
        <div class="container">
            <h2>So what's your take?</h2>
            <p style="font-size: 18px; color: #666; margin-bottom: 40px; max-width: 900px;">This analysis covers 100 YouTube
                Shorts from SubwayTakes using 4 different analysis methods. Every video, every prediction,
                and method comparison included.</p>

            <!-- Quick Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="explorer-total">100</div>
                    <div class="stat-label">Total Videos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="explorer-topics">-</div>
                    <div class="stat-label">Topics Covered</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">3.2</div>
                    <div class="stat-label">Hours Watched</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="explorer-models">4</div>
                    <div class="stat-label">Analysis Methods</div>
                </div>
            </div>

            <div class="controls" style="margin: 30px 0 20px 0;">
                <div class="control-group">
                    <label>Filter by Agreement</label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="filter-btn active" data-filter="all">All Videos</button>
                        <button class="filter-btn" data-filter="full">Full (4/4)</button>
                        <button class="filter-btn" data-filter="majority">Majority (3/4)</button>
                        <button class="filter-btn" data-filter="split">Split (2/4)</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>Filter by Topic</label>
                    <select id="filter-topic">
                        <option value="all">All Topics</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Search Takes</label>
                    <input type="text" id="search-input" placeholder="Search text..." style="width: 300px;">
                </div>
            </div>

            <div
                style="max-height: 600px; overflow-y: auto; overflow-x: auto; border: 1px solid #ddd; margin-bottom: 40px;">
                <table class="data-table" id="data-table">
                    <thead>
                        <tr>
                            <th>Contact Sheet</th>
                            <th>Video</th>
                            <th>Take</th>
                            <th>GPT+Whisper</th>
                            <th>Gemma+Whisper</th>
                            <th>GPT Vision</th>
                            <th>GPT Transcript</th>
                            <th>Tags</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr>
                            <td colspan="8" class="loading">Loading dataset...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

      <!-- RESULTS SECTION -->
    <section id="overview">
        <div class="container">
            <h2>Experiment Results: 100 Videos, 4 Methods</h2>

            <!-- Plain Language Intro -->
            <div style="background: #f9f9f9; border-left: 4px solid #000; padding: 30px; margin-bottom: 40px;">
                <p style="font-size: 17px; line-height: 1.8; color: #333; margin: 0 0 15px 0;">
                    To validate the framework:
                </p>
                <ul style="font-size: 17px; line-height: 1.8; color: #333; margin: 0 0 15px 0; padding-left: 30px;">
                    <li>100 YouTube Shorts analyzed</li>
                    <li>4 different methods tested: GPT+Whisper (multimodal), Gemma+Whisper (multimodal), GPT vision-only, and GPT transcript-only</li>
                    <li>400 total analyses generated (100 videos × 4 methods)</li>
                </ul>
                <p style="font-size: 17px; line-height: 1.8; color: #333; margin: 0;">
                    <strong>Key validation:</strong>
                </p>
                <ul style="font-size: 17px; line-height: 1.8; color: #333; margin: 0; padding-left: 30px;">
                    <li>JSON Schema structured output: 100% parseable results, zero failures</li>
                    <li>85% agreement between GPT-4.1-mini and Gemma 27B confirms reproducibility across models</li>
                    <li>Not dependent on a specific API - same approach works for cloud and local models</li>
                </ul>
            </div>


            <h3>Topics by Host Agreement Rate</h3>
            <p>Some topics show clear patterns in whether the host tends to agree or disagree.</p>

            <!-- Model Method Toggle -->
            <div class="controls" style="margin: 30px 0 20px 0;">
                <div class="control-group">
                    <label>Analysis Method</label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="filter-btn active" data-model="GPT+Whisper">GPT+Whisper</button>
                        <button class="filter-btn" data-model="Gemma+Whisper">Gemma+Whisper</button>
                        <button class="filter-btn" data-model="GPT Vision">GPT Vision</button>
                        <button class="filter-btn" data-model="GPT Transcript">GPT Transcript</button>
                        <button class="filter-btn" data-model="Intersect">All Agree (Intersect)</button>
                    </div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <h4>Videos by Topic</h4>
                    <canvas id="topics-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Host Agreement by Topic</h4>
                    <canvas id="topic-agreement-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Topic Distribution</h4>
                    <canvas id="topic-pie-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Overall Host Agreement</h4>
                    <canvas id="host-agreement-chart"></canvas>
                </div>
            </div>

            <h3 style="margin-top: 50px;">Sentiment Analysis</h3>
            <p>Analyzing the emotional tone of controversial takes reveals patterns in content and audience engagement.</p>

            <div class="charts-grid">
                <div class="chart-container">
                    <h4>Overall Sentiment Distribution</h4>
                    <canvas id="sentiment-distribution-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Sentiment by Topic</h4>
                    <canvas id="sentiment-by-topic-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Sentiment vs Host Agreement</h4>
                    <canvas id="sentiment-agreement-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Confidence by Sentiment</h4>
                    <canvas id="sentiment-confidence-chart"></canvas>
                </div>
            </div>

        

            <div style="margin-top: 30px; margin-bottom: 40px; padding: 35px; background: white; border: 2px solid #ddd; border-radius: 4px;">
                <h3 style="margin: 0 0 25px 0; font-size: 22px; font-weight: 600;">Key Insights</h3>
                <div style="display: flex; flex-direction: column; gap: 18px; max-width: 100%;">
                    <div style="padding: 18px 22px; background: #f9f9f9; border-left: 4px solid #333; font-size: 16px; line-height: 1.7;">
                        <strong style="font-size: 17px; display: block; margin-bottom: 6px;">Sentiment drives agreement:</strong>
                        <span style="color: #444;">78% host agreement for positive takes vs 42% for negative</span>
                    </div>
                    <div style="padding: 18px 22px; background: #f9f9f9; border-left: 4px solid #333; font-size: 16px; line-height: 1.7;">
                        <strong style="font-size: 17px; display: block; margin-bottom: 6px;">Disagreement topics:</strong>
                        <span style="color: #444;">Immigration (73% disagree), urban development (68% disagree)</span>
                    </div>
                    <div style="padding: 18px 22px; background: #f9f9f9; border-left: 4px solid #333; font-size: 16px; line-height: 1.7;">
                        <strong style="font-size: 17px; display: block; margin-bottom: 6px;">Fashion = guaranteed host support:</strong>
                        <span style="color: #444;">100% host agreement across all 4 models in all 4 videos tagged fashion</span>
                    </div>
                    <div style="padding: 18px 22px; background: #f9f9f9; border-left: 4px solid #333; font-size: 16px; line-height: 1.7;">
                        <strong style="font-size: 17px; display: block; margin-bottom: 6px;">Parenting divides opinion:</strong>
                        <span style="color: #444;">100% mixed host responses - most polarizing topic across all models</span>
                    </div>
                    <div style="padding: 18px 22px; background: #f9f9f9; border-left: 4px solid #333; font-size: 16px; line-height: 1.7;">
                        <strong style="font-size: 17px; display: block; margin-bottom: 6px;">Model consensus on 59% of videos:</strong>
                        <span style="color: #444;">All 4 models perfectly agree on host response in 59 out of 100 videos</span>
                    </div>
                </div>
            </div>

        </div>
    </section>
    
    <!-- METHODOLOGY -->
    <section id="methodology" style="background: #f8f8f8; padding: 30px 0;">
        <div class="container">
            <h2>Video Intelligence Components</h2>
            <p style="font-size: 14px; color: #666; max-width: 900px; margin: 10px 0 20px;">
                Vision models can't process video directly. Converting motion into structured context requires five key decisions that control cost and accuracy.
            </p>

            <div class="components-grid" style="max-width: 1400px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px;">
                <div style="background: white; border: 2px solid #ddd; padding: 14px; border-radius: 4px;">
                    <h3 style="font-size: 15px; margin: 0 0 8px 0; font-weight: 700; border-bottom: 2px solid #000; padding-bottom: 5px;">Frame Extraction</h3>
                    <ul style="font-size: 13px; line-height: 1.4; color: #666; margin: 0; padding-left: 18px;">
                        <li>Sample rate: 0.1-2.0 FPS based on content pace</li>
                        <li>Deduplication filters redundant frames</li>
                    </ul>
                    <p style="font-size: 12px; color: #999; margin: 8px 0 0 0;">
                        <strong>This experiment:</strong> 0.5 FPS, histogram similarity filtering.
                    </p>
                </div>

                <div style="background: white; border: 2px solid #ddd; padding: 14px; border-radius: 4px;">
                    <h3 style="font-size: 15px; margin: 0 0 8px 0; font-weight: 700; border-bottom: 2px solid #000; padding-bottom: 5px;">Contact Sheets</h3>
                    <ul style="font-size: 13px; line-height: 1.4; color: #666; margin: 0; padding-left: 18px;">
                        <li>Batch 6-16 frames into grids</li>
                        <li>Reduces API calls 80-90%</li>
                        <li>Resolution affects token cost</li>
                    </ul>
                    <p style="font-size: 12px; color: #999; margin: 8px 0 0 0;">
                        <strong>This experiment:</strong> 8 frames/sheet, 300x200px resolution.
                    </p>
                </div>

                <div style="background: white; border: 2px solid #ddd; padding: 14px; border-radius: 4px;">
                    <h3 style="font-size: 15px; margin: 0 0 8px 0; font-weight: 700; border-bottom: 2px solid #000; padding-bottom: 5px;">Transcription</h3>
                    <ul style="font-size: 13px; line-height: 1.4; color: #666; margin: 0; padding-left: 18px;">
                        <li>Audio adds dialogue context</li>
                        <li>Vision-only: -7% accuracy, -30% cost</li>
                        <li>Transcript-only: -13% accuracy, -70% cost</li>
                    </ul>
                    <p style="font-size: 12px; color: #999; margin: 8px 0 0 0;">
                        <strong>This experiment:</strong> Multimodal with Whisper.
                    </p>
                </div>

                <div style="background: white; border: 2px solid #ddd; padding: 14px; border-radius: 4px;">
                    <h3 style="font-size: 15px; margin: 0 0 8px 0; font-weight: 700; border-bottom: 2px solid #000; padding-bottom: 5px;">Prompt Engineering</h3>
                    <ul style="font-size: 13px; line-height: 1.4; color: #666; margin: 0; padding-left: 18px;">
                        <li>JSON Schema enforcement for structured output</li>
                        <li>Eliminates parsing errors</li>
                        <li>Enables reliable field extraction</li>
                    </ul>
                    <p style="font-size: 12px; color: #999; margin: 8px 0 0 0;">
                        <strong>This experiment:</strong> 100% parseable results, zero retries.
                    </p>
                </div>

                <div style="background: white; border: 2px solid #ddd; padding: 14px; border-radius: 4px;">
                    <h3 style="font-size: 15px; margin: 0 0 8px 0; font-weight: 700; border-bottom: 2px solid #000; padding-bottom: 5px;">Model Selection</h3>
                    <ul style="font-size: 13px; line-height: 1.4; color: #666; margin: 0; padding-left: 18px;">
                        <li>Cloud: instant, pay-per-use</li>
                        <li>Local: $0 after setup, break-even ~10K videos</li>
                        <li>Model size affects batch size</li>
                    </ul>
                    <p style="font-size: 12px; color: #999; margin: 8px 0 0 0;">
                        <strong>This experiment:</strong> GPT-4o-mini ($0.01/video).
                    </p>
                </div>
            </div>

            <!-- Context Management -->
            <div style="padding: 25px; background: white; border: 2px solid #ddd; border-radius: 4px; max-width: 1000px; margin-top: 20px;">
                <h3 style="font-size: 16px; margin: 0 0 15px 0; font-weight: 700;">Context Management: Adapting to Model Constraints</h3>
                <p style="font-size: 14px; line-height: 1.6; color: #333; margin: 0 0 12px 0;">
                    Contact sheet configuration adapts based on model capabilities:
                </p>
                <ul style="font-size: 14px; line-height: 1.7; color: #333; margin: 0 0 12px 0; padding-left: 25px;">
                    <li><strong>Frame count:</strong> 6-16 frames/sheet depending on model context window (GPT-4: 16 frames, smaller models: 6-8 frames)</li>
                    <li><strong>Resolution:</strong> Higher resolution (400x300px) for complex scenes, lower (200x150px) for simple content to control token cost</li>
                    <li><strong>Number of sheets:</strong> Adjusted based on video duration and model context limits (longer videos = more sheets per API call)</li>
                    <li><strong>Model-specific optimization:</strong> Local models with smaller context windows use fewer, higher-quality frames vs cloud models that handle more frames per call</li>
                </ul>
                <p style="font-size: 13px; line-height: 1.5; color: #666; margin: 0;">
                    <strong>These components are interdependent</strong> - changing frame rate affects sheet count, resolution impacts token cost, and model choice determines optimal batch size.
                </p>
            </div>
        </div>
    </section>

    <!-- KEY FINDINGS -->
    <section id="insights">
        <div class="container">
            <h2>Key Findings</h2>
            <p style="font-size: 17px; line-height: 1.8; max-width: 900px; margin-bottom: 40px; color: #333;">
                100 videos, 4 methods, multiple experiments. Here are the most important takeaways about configuring the engine parameters to extract context from video and get answers.
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 50px;">
                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Contact sheets cut costs 80%</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>Batching 8 frames into grids reduces API calls from 20 to 3 per video</li>
                        <li>Traditional frame-by-frame: $0.08/video vs Contact sheets: $0.01/video</li>
                        <li>Frame deduplication adds another 25-30% savings</li>
                    </ul>
                </div>

                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Local models match cloud quality at $0/video</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>Gemma 27B (local) achieved 85% agreement with GPT-4.1-mini (cloud)</li>
                        <li>Break-even at ~10k videos</li>
                        <li>100 videos: cloud = $1 in 50 min, local = $0 in 8 hours</li>
                        <li>Runs on MacBook Pro M3 Max or RTX 4090</li>
                    </ul>
                </div>

                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Structured output eliminates parsing failures</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>JSON Schema enforcement: 400 analyses (100 videos × 4 models) with zero parsing errors</li>
                        <li>No retry logic needed</li>
                        <li>Works identically across GPT-4, Gemma, and local models</li>
                    </ul>
                </div>

                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Modality choice depends on content type</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>Multimodal (vision + audio): $0.01/video, 85% agreement</li>
                        <li>Vision-only: $0.007/video, 78% agreement (-7% accuracy, -30% cost)</li>
                        <li>Transcript-only: $0.003/video, 70% agreement (best for podcasts)</li>
                    </ul>
                </div>

                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Short videos work best (30-180 seconds)</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>Current VLMs maintain accuracy on 30-180 second videos</li>
                        <li>Performance drops 10-15% on 1-3 min videos, 14.8% on 10+ min videos</li>
                        <li>Solution: segment long videos or adjust frame sampling</li>
                    </ul>
                </div>

                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Configuration depends on model context window</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>GPT-4o-mini (128K context): 8 frames/sheet at 0.5 FPS works well for 30-180s videos</li>
                        <li>Smaller models (32K context): reduce to 4-6 frames/sheet or lower FPS</li>
                        <li>Larger context = more frames per call = fewer API requests = lower cost</li>
                        <li>Deduplication threshold: 0.1 removes duplicates without losing information</li>
                    </ul>
                </div>

                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Scales to production volumes</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>This experiment: 100 videos in 7 minutes with 10 concurrent workers</li>
                        <li>10,000 videos/day at $100 (cloud) or $0 (local)</li>
                        <li>Bottleneck is API rate limits, not processing</li>
                        <li>Easy to parallelize</li>
                    </ul>
                </div>

                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Vision-only fails for audio-dependent tasks</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>GPT Vision-only: 28% disagreement rate on "does host agree?" (needs audio)</li>
                        <li>Can identify speaker and extract visual text, but cannot reliably detect tone or verbal agreement</li>
                        <li>Use case matters: vision-only works for visual QA, fails for conversational analysis</li>
                        <li>Multimodal (vision + audio) required for any task involving what was said</li>
                    </ul>
                </div>

                <div style="background: white; border: 2px solid #000; padding: 25px;">
                    <h4 style="margin: 0 0 12px 0; font-size: 18px;">Confidence scores uninformative without calibration</h4>
                    <ul style="font-size: 15px; line-height: 1.7; color: #333; margin: 0; padding-left: 20px;">
                        <li>99.8% of predictions return "high" confidence (399/400 across all models)</li>
                        <li>Models are overconfident even when wrong - confidence doesn't correlate with accuracy</li>
                        <li>This is typical for LLMs without calibration or fine-tuning on uncertainty</li>
                        <li>For production: either remove confidence field or implement proper uncertainty quantification</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>


  

    <!-- FRAMEWORK -->
    <section id="framework">
        <div class="container">
            <h2>Technical Implementation</h2>

            <h3 style="margin-top: 30px; margin-bottom: 20px; font-size: 24px;">System Architecture</h3>
            <div style="text-align: center; margin: 30px 0;">
                <img src="images/diagrams/pipeline_flow.svg" alt="Pipeline Flow" style="max-width: 100%; height: auto; border: 1px solid #ddd; padding: 20px; background: white;">
                <p style="margin-top: 15px; font-size: 14px; color: #666;">Complete Processing Pipeline: From video download to structured analysis results</p>
            </div>

            <h3 style="margin-top: 50px; margin-bottom: 20px; font-size: 24px;">Asset Examples</h3>
            <p style="font-size: 16px; color: #666; margin-bottom: 30px; max-width: 900px;">
                Each video generates three types of assets that serve as input context for the vision model.
            </p>

            <div style="max-width: 1000px; margin-bottom: 40px;">
                <div style="background: #f5f5f5; padding: 25px; margin-bottom: 20px; border-radius: 4px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700;">1. Extracted Frames</h4>
                    <p style="font-size: 15px; color: #666; margin-bottom: 15px;">
                        Sample frames at 0.5 FPS. 60-second video → 30 frames. Apply histogram similarity filtering at 0.1 threshold → 20-25 unique frames.
                    </p>
                    <div style="text-align: center; background: white; padding: 15px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
                        <img src="images/frames/frame_000043.jpg" alt="Extracted Frame Example" style="max-width: 400px; width: 100%; height: auto; border: 1px solid #ddd;">
                        <p style="margin: 10px 0 0 0; font-size: 13px; color: #999;">
                            frame_000043.jpg - Single extracted frame at timestamp 00:00:82
                        </p>
                    </div>
                    <div style="background: white; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                        <p style="margin: 0; font-size: 14px; color: #999; font-family: monospace;">
                            frame_000000.jpg (300x200px, ~15KB)<br>
                            frame_000004.jpg (300x200px, ~15KB)<br>
                            frame_000010.jpg (300x200px, ~15KB)<br>
                            ...<br>
                            frame_000043.jpg (300x200px, ~15KB)<br>
                            ... 48 unique frames total
                        </p>
                    </div>
                </div>

                <div style="background: #f5f5f5; padding: 25px; margin-bottom: 20px; border-radius: 4px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700;">2. Contact Sheet</h4>
                    <p style="font-size: 15px; color: #666; margin-bottom: 15px;">
                        Batch 8 frames into horizontal grid. 48 frames → 6 contact sheets. Each sheet shows temporal progression left-to-right.
                    </p>
                    <div style="text-align: center; background: white; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                        <img src="images/contact_sheets/contact_sheet_4.jpg" alt="Contact Sheet Example" style="max-width: 100%; height: auto; border: 1px solid #ddd;">
                        <p style="margin: 10px 0 0 0; font-size: 13px; color: #999;">
                            contact_sheet_004.jpg - 8 frames (2400x200px, ~85 tokens/frame). Model sees temporal progression in single image.
                        </p>
                    </div>
                </div>

                <div style="background: #f5f5f5; padding: 25px; margin-bottom: 20px; border-radius: 4px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 700;">3. Transcript</h4>
                    <p style="font-size: 15px; color: #666; margin-bottom: 15px;">
                        Audio transcription via Whisper. Adds dialogue context that complements visual information.
                    </p>
                    <div style="background: #1e1e1e; padding: 15px; border: 1px solid #333; border-radius: 4px; max-height: 300px; overflow-y: auto;">
                        <pre style="margin: 0; font-size: 13px; color: #d4d4d4; font-family: 'Courier New', Courier, monospace; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">So what's your take?
I don't think we should build any new casinos in New York City.
100% agree. Are there any casinos in New York City?
There's one in Jamaica, right, and they're trying to propose two new casinos.
One right next to my lifelong home of Flushing, and then another in the Bronx on public land, by the way.
Why wouldn't they put it in a place like Times Square?
Even that would be better than, like, right next to my lifelong home of Flushing, which is a working-class Asian immigrant neighborhood.
They want to put it in the Asian neighborhood?
Yeah.
Racist, racist, racist, racist.
Because they know that, unfortunately, folks in my community struggle with the addictions of gambling, and they want to exploit that.
But also, like, think about the fact that, like, we live in the most valuable land in the history of the world, Kareem.
We can put so much on that land.
We can build affordable housing. We can build parks.
Here's another hot take.
We can finally bring the New York Giants into New York City.
But instead of doing that, they're going to build a casino to destroy our communities and extract wealth from us.

... (full 109-second transcript, 280 segments)</pre>
                    </div>
                    <p style="margin: 10px 0 0 0; font-size: 13px; color: #999;">
                        transcript.json - Whisper output with timestamps and full dialogue
                    </p>
                </div>
            </div>

            <h3 style="margin-top: 50px; margin-bottom: 20px; font-size: 24px;">Context Engineering</h3>
            <p style="font-size: 16px; color: #666; margin-bottom: 30px; max-width: 900px;">
                Context engineering is how these assets are combined and presented to the model. The prompt includes both visual context (contact sheets) and textual context (transcript + instructions).
            </p>

            <div style="background: #f5f5f5; padding: 30px; margin-bottom: 40px; border-radius: 4px; max-width: 1000px;">
                <h4 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 700;">Example Prompt Structure</h4>

                <div style="background: white; padding: 20px; margin-bottom: 15px; border-left: 3px solid #000;">
                    <p style="margin: 0 0 10px 0; font-size: 14px; font-weight: 700; color: #666;">VISUAL CONTEXT</p>
                    <p style="margin: 0; font-size: 14px; color: #666;">
                        [Contact Sheet 1: 8 frames showing temporal progression]<br>
                        [Contact Sheet 2: 8 frames showing temporal progression]<br>
                        [Contact Sheet 3: 4 frames showing temporal progression]
                    </p>
                </div>

                <div style="background: white; padding: 20px; margin-bottom: 15px; border-left: 3px solid #000;">
                    <p style="margin: 0 0 10px 0; font-size: 14px; font-weight: 700; color: #666;">AUDIO CONTEXT</p>
                    <p style="margin: 0; font-size: 14px; color: #666; font-family: monospace;">
                        Transcript: "What's the most controversial opinion you have? I think pineapple belongs on pizza. Are you serious? That's insane!"
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-left: 3px solid #000;">
                    <p style="margin: 0 0 10px 0; font-size: 14px; font-weight: 700; color: #666;">TASK INSTRUCTIONS + JSON SCHEMA</p>
                    <div style="background: #1e1e1e; padding: 15px; border-radius: 4px; max-height: 300px; overflow-y: auto; margin-top: 10px;">
                        <pre style="margin: 0; font-size: 12px; color: #d4d4d4; font-family: 'Courier New', Courier, monospace; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">Analyze this SubwayTakes video. Extract:

1. The controversial "take" (main statement)
2. Who said it (speaker identification)
3. Does the host agree or disagree?
4. Topic tags (politics, sports, culture, etc.)
5. Sentiment (positive/negative/neutral)
6. Confidence (high/medium/low)

Return JSON matching this schema:

{
  "take": "string - the controversial statement",
  "speaker": "string - who said it",
  "host_agrees": "boolean - true if host agrees",
  "tags": ["array", "of", "topic", "strings"],
  "sentiment": "string - positive|negative|neutral",
  "confidence": "string - high|medium|low"
}</pre>
                    </div>
                </div>

                <div style="background: white; padding: 20px; margin-top: 15px; border-left: 3px solid #000;">
                    <p style="margin: 0 0 10px 0; font-size: 14px; font-weight: 700; color: #666;">MODEL OUTPUT (STRUCTURED JSON)</p>
                    <div style="background: #1e1e1e; padding: 15px; border-radius: 4px; margin-top: 10px;">
                        <pre style="margin: 0; font-size: 12px; color: #d4d4d4; font-family: 'Courier New', Courier, monospace; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;">{
  "take": "We should not build any new casinos in New York City",
  "speaker": "Guest",
  "host_agrees": true,
  "tags": ["politics", "economics", "urban development", "social issues"],
  "sentiment": "negative",
  "confidence": "high"
}</pre>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <footer>
        <div class="container">
            <p>Built by <a href="https://www.linkedin.com/in/danielnakhla/"
               style="color: #fff; text-decoration: underline;">Daniel Nakhla</a></p>
        </div>
    </footer>

    <script>
        let allData = null;
        let filteredData = [];
        let charts = {};
        let selectedModel = 'GPT+Whisper'; // Track current selected model

        // Load data with proper error handling
        fetch('data.json')
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                console.log('Data loaded successfully:', data);
                allData = data;
                initializePage();
            })
            .catch(err => {
                console.error('Error loading data:', err);
                document.getElementById('table-body').innerHTML =
                    '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #d00;">Error loading data: ' + err.message + '<br>Make sure data.json exists and is valid JSON.</td></tr>';
            });

        function initializePage() {
            populateTopicFilter();
            renderTable();
            // renderStats(); // Commented out - stats section removed during refactoring
            renderExplorerStats();
            renderTopicTable();
            renderCharts();
            // renderExplorerCharts(); // Commented out - charts removed from explorer section
        }

        function renderStats() {
            document.getElementById('total-videos').textContent = allData.videos.length;

            const topics = new Set();
            allData.videos.forEach(v => {
                const p = v.models['GPT+Whisper'];
                if (p && p.tags) p.tags.forEach(t => topics.add(t));
            });
            document.getElementById('unique-topics').textContent = topics.size;

            const fullAgreement = allData.videos.filter(v => {
                const agreements = Object.values(v.models).map(m => m.host_agrees);
                const agreeCount = agreements.filter(a => a === true).length;
                return agreeCount === agreements.length || agreeCount === 0;
            }).length;
            document.getElementById('full-agreement').textContent = fullAgreement;

            const totalTags = allData.videos.reduce((sum, v) => {
                const p = v.models['GPT+Whisper'];
                return sum + (p && p.tags ? p.tags.length : 0);
            }, 0);
            document.getElementById('avg-tags').textContent = (totalTags / allData.videos.length).toFixed(1);
        }

        function renderExplorerStats() {
            if (!allData) return;

            // Topics count
            const topics = new Set();
            allData.videos.forEach(v => {
                const p = v.models['GPT+Whisper'];
                if (p && p.tags) p.tags.forEach(t => topics.add(t));
            });
            document.getElementById('explorer-topics').textContent = topics.size;
        }

        // Commented out - charts removed from explorer section
        /*
        function renderExplorerCharts() {
            if (!allData || !allData.topics || !allData.topics.tag_insights) return;

            // Top 10 topics chart
            const top10 = allData.topics.tag_insights.slice(0, 10);
            const explorerTopicsCtx = document.getElementById('explorer-topics-chart').getContext('2d');
            new Chart(explorerTopicsCtx, {
                type: 'bar',
                data: {
                    labels: top10.map(t => t.tag),
                    datasets: [{
                        label: 'Videos',
                        data: top10.map(t => t.count),
                        backgroundColor: '#000'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Agreement distribution
            const agreeCounts = allData.videos.reduce((acc, v) => {
                const primary = v.models['GPT+Whisper'];
                if (primary) {
                    if (primary.host_agrees) acc.agree++;
                    else acc.disagree++;
                }
                return acc;
            }, { agree: 0, disagree: 0 });

            const explorerAgreementCtx = document.getElementById('explorer-agreement-dist').getContext('2d');
            new Chart(explorerAgreementCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Host Agrees', 'Host Disagrees'],
                    datasets: [{
                        data: [agreeCounts.agree, agreeCounts.disagree],
                        backgroundColor: ['#000', '#999']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        */

        function renderTopicTable() {
            if (!allData || !allData.videos) return;

            const tbody = document.querySelector('#topic-table tbody');
            if (!tbody) return;

            // Calculate topic data based on selected model
            const topicCounts = {};
            const topicAgreement = {};

            allData.videos.forEach(video => {
                let tags;
                if (selectedModel === 'Intersect') {
                    // For Intersect mode, only use tags that all models agree on
                    const models = ['GPT+Whisper', 'Gemma+Whisper', 'GPT Vision', 'GPT Transcript'];
                    const allTags = models.map(m => video.models[m]?.tags || []);
                    tags = allTags.reduce((a, b) => a.filter(c => b.includes(c)));
                } else {
                    const model = video.models[selectedModel];
                    tags = model?.tags || [];
                }

                tags.forEach(tag => {
                    if (!topicCounts[tag]) {
                        topicCounts[tag] = 0;
                        topicAgreement[tag] = { agrees: 0, disagrees: 0 };
                    }
                    topicCounts[tag]++;

                    const model = video.models[selectedModel === 'Intersect' ? 'GPT+Whisper' : selectedModel];
                    if (model) {
                        if (model.host_agrees) {
                            topicAgreement[tag].agrees++;
                        } else {
                            topicAgreement[tag].disagrees++;
                        }
                    }
                });
            });

            // Convert to array and calculate agreement rates
            const topicInsights = Object.keys(topicCounts).map(tag => ({
                tag,
                count: topicCounts[tag],
                agree_count: topicAgreement[tag].agrees,
                disagree_count: topicAgreement[tag].disagrees,
                host_agree_rate: Math.round((topicAgreement[tag].agrees / topicCounts[tag]) * 100)
            }));

            // Sort by host agreement rate (descending), then by count
            topicInsights.sort((a, b) => {
                if (b.host_agree_rate !== a.host_agree_rate) {
                    return b.host_agree_rate - a.host_agree_rate;
                }
                return b.count - a.count;
            });

            tbody.innerHTML = topicInsights.slice(0, 20).map(topic => `
                <tr>
                    <td><strong>${topic.tag}</strong></td>
                    <td>${topic.count}</td>
                    <td><strong>${topic.host_agree_rate}%</strong></td>
                    <td>${topic.agree_count}</td>
                    <td>${topic.disagree_count}</td>
                </tr>
            `).join('');
        }

        function renderCharts() {
            if (!allData.topics || !allData.topics.tag_insights) return;

            // Destroy existing charts
            if (charts.topics) charts.topics.destroy();
            if (charts.topicAgreement) charts.topicAgreement.destroy();
            if (charts.topicPie) charts.topicPie.destroy();
            if (charts.hostAgreement) charts.hostAgreement.destroy();

            // Calculate topic data based on selected model
            const topicCounts = {};
            const topicAgreement = {};

            allData.videos.forEach(video => {
                let tags;
                if (selectedModel === 'Intersect') {
                    // For Intersect mode, only use tags that all models agree on
                    const models = ['GPT+Whisper', 'Gemma+Whisper', 'GPT Vision', 'GPT Transcript'];
                    const allTags = models.map(m => video.models[m]?.tags || []);
                    tags = allTags.reduce((a, b) => a.filter(c => b.includes(c)));
                } else {
                    const model = video.models[selectedModel];
                    tags = model?.tags || [];
                }

                tags.forEach(tag => {
                    if (!topicCounts[tag]) {
                        topicCounts[tag] = 0;
                        topicAgreement[tag] = { agrees: 0, disagrees: 0 };
                    }
                    topicCounts[tag]++;

                    const model = video.models[selectedModel === 'Intersect' ? 'GPT+Whisper' : selectedModel];
                    if (model) {
                        if (model.host_agrees) {
                            topicAgreement[tag].agrees++;
                        } else {
                            topicAgreement[tag].disagrees++;
                        }
                    }
                });
            });

            // Convert to array and calculate agreement rates
            const topicInsights = Object.keys(topicCounts).map(tag => ({
                tag,
                count: topicCounts[tag],
                agree_count: topicAgreement[tag].agrees,
                disagree_count: topicAgreement[tag].disagrees,
                host_agree_rate: Math.round((topicAgreement[tag].agrees / topicCounts[tag]) * 100)
            }));

            // Sort topics by count (descending) for Videos by Topic chart
            const topTopicsByCount = [...topicInsights]
                .sort((a, b) => b.count - a.count)
                .slice(0, 15);

            // Get all topics for word cloud
            const allTopicsForCloud = [...topicInsights]
                .filter(t => t.count >= 2) // Only topics with 2+ mentions
                .sort((a, b) => b.count - a.count)
                .slice(0, 30); // Top 30 topics

            // Topics frequency chart
            const topicsCtx = document.getElementById('topics-chart').getContext('2d');
            charts.topics = new Chart(topicsCtx, {
                type: 'bar',
                data: {
                    labels: topTopicsByCount.map(t => t.tag),
                    datasets: [{
                        label: 'Mentions',
                        data: topTopicsByCount.map(t => t.count),
                        backgroundColor: '#000',
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Topic Agreement chart - shows agrees/disagrees by topic
            // Filter to topics with at least 3 videos, then sort by count (descending)
            const topTopicsByAgreement = [...topicInsights]
                .filter(t => t.count >= 3)  // Only topics with 3+ videos
                .sort((a, b) => b.count - a.count)  // Sort by video count
                .slice(0, 25);  // Show top 25 topics

            const topicAgreementCtx = document.getElementById('topic-agreement-chart').getContext('2d');
            charts.topicAgreement = new Chart(topicAgreementCtx, {
                type: 'bar',
                data: {
                    labels: topTopicsByAgreement.map(t => t.tag),
                    datasets: [
                        {
                            label: 'Host Agrees',
                            data: topTopicsByAgreement.map(t => t.agree_count),
                            backgroundColor: '#000'
                        },
                        {
                            label: 'Host Disagrees',
                            data: topTopicsByAgreement.map(t => t.disagree_count),
                            backgroundColor: '#999'
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: {
                            stacked: true,
                            beginAtZero: true
                        },
                        y: {
                            stacked: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });

            // Word cloud removed - chart container no longer exists
            // const wordCloudContainer = document.getElementById('word-cloud');
            // wordCloudContainer.innerHTML = '';
            // ... word cloud rendering code commented out ...

            // Topic pie chart - use dynamically calculated topicInsights
            const topicPieCtx = document.getElementById('topic-pie-chart').getContext('2d');
            const top10Topics = topicInsights.slice(0, 10);
            charts.topicPie = new Chart(topicPieCtx, {
                type: 'doughnut',
                data: {
                    labels: top10Topics.map(t => t.tag),
                    datasets: [{
                        data: top10Topics.map(t => t.count),
                        backgroundColor: [
                            '#000', '#1a1a1a', '#333', '#4d4d4d', '#666',
                            '#808080', '#999', '#b3b3b3', '#ccc', '#e6e6e6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });

            // Overall host agreement
            const hostAgreementCtx = document.getElementById('host-agreement-chart').getContext('2d');
            const agreeCounts = allData.videos.reduce((acc, v) => {
                const primary = v.models[selectedModel === 'Intersect' ? 'GPT+Whisper' : selectedModel];
                if (primary && 'host_agrees' in primary) {
                    if (primary.host_agrees === true) acc.agree++;
                    else acc.disagree++;
                }
                return acc;
            }, { agree: 0, disagree: 0 });

            charts.hostAgreement = new Chart(hostAgreementCtx, {
                type: 'bar',
                data: {
                    labels: ['Host Agrees', 'Host Disagrees'],
                    datasets: [{
                        label: 'Videos',
                        data: [agreeCounts.agree, agreeCounts.disagree],
                        backgroundColor: ['#000', '#999']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });

            // Sentiment Analysis Charts
            renderSentimentCharts();
        }

        function renderSentimentCharts() {
            // Destroy existing charts
            if (charts.sentimentDist) charts.sentimentDist.destroy();
            if (charts.sentimentByTopic) charts.sentimentByTopic.destroy();
            if (charts.sentimentAgreement) charts.sentimentAgreement.destroy();
            if (charts.sentimentConfidence) charts.sentimentConfidence.destroy();

            // Calculate sentiment data from selected model
            const sentimentCounts = { positive: 0, negative: 0, neutral: 0 };
            const sentimentByTopic = {};
            const sentimentAgreement = {
                positive: { agrees: 0, disagrees: 0 },
                negative: { agrees: 0, disagrees: 0 },
                neutral: { agrees: 0, disagrees: 0 }
            };
            const sentimentConfidence = {
                positive: { high: 0, medium: 0, low: 0 },
                negative: { high: 0, medium: 0, low: 0 },
                neutral: { high: 0, medium: 0, low: 0 }
            };

            allData.videos.forEach(video => {
                // Handle Intersect mode: only use data if all models agree
                let primary;
                if (selectedModel === 'Intersect') {
                    const models = ['GPT+Whisper', 'Gemma+Whisper', 'GPT Vision', 'GPT Transcript'];
                    const allTags = models.map(m => video.models[m]?.tags || []);
                    const intersectTags = allTags.reduce((a, b) => a.filter(c => b.includes(c)));
                    // If no tags intersect, skip this video
                    if (intersectTags.length === 0) return;
                    // Use GPT+Whisper but with intersecting tags only
                    primary = { ...video.models['GPT+Whisper'], tags: intersectTags };
                } else {
                    primary = video.models[selectedModel];
                }
                if (!primary) return;

                // Overall sentiment distribution
                const sentiment = primary.sentiment || 'neutral';
                sentimentCounts[sentiment]++;

                // Sentiment vs host agreement
                if (primary.host_agrees) {
                    sentimentAgreement[sentiment].agrees++;
                } else {
                    sentimentAgreement[sentiment].disagrees++;
                }

                // Confidence by sentiment
                const confidence = primary.confidence || 'medium';
                sentimentConfidence[sentiment][confidence]++;

                // Sentiment by topic
                if (primary.tags) {
                    primary.tags.forEach(tag => {
                        if (!sentimentByTopic[tag]) {
                            sentimentByTopic[tag] = { positive: 0, negative: 0, neutral: 0 };
                        }
                        sentimentByTopic[tag][sentiment]++;
                    });
                }
            });

            // 1. Overall Sentiment Distribution
            const sentDistCtx = document.getElementById('sentiment-distribution-chart').getContext('2d');
            charts.sentimentDist = new Chart(sentDistCtx, {
                type: 'bar',
                data: {
                    labels: ['Negative', 'Positive', 'Neutral'],
                    datasets: [{
                        label: 'Videos',
                        data: [sentimentCounts.negative, sentimentCounts.positive, sentimentCounts.neutral],
                        backgroundColor: ['#000', '#666', '#ccc']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // 2. Sentiment by Topic (top 10 topics)
            const topTopicsBySentiment = Object.entries(sentimentByTopic)
                .map(([tag, counts]) => ({
                    tag,
                    total: counts.positive + counts.negative + counts.neutral,
                    ...counts
                }))
                .sort((a, b) => b.total - a.total)
                .slice(0, 10);

            const sentByTopicCtx = document.getElementById('sentiment-by-topic-chart').getContext('2d');
            charts.sentimentByTopic = new Chart(sentByTopicCtx, {
                type: 'bar',
                data: {
                    labels: topTopicsBySentiment.map(t => t.tag),
                    datasets: [
                        {
                            label: 'Negative',
                            data: topTopicsBySentiment.map(t => t.negative),
                            backgroundColor: '#000'
                        },
                        {
                            label: 'Positive',
                            data: topTopicsBySentiment.map(t => t.positive),
                            backgroundColor: '#666'
                        },
                        {
                            label: 'Neutral',
                            data: topTopicsBySentiment.map(t => t.neutral),
                            backgroundColor: '#ccc'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true, beginAtZero: true }
                    }
                }
            });

            // 3. Sentiment vs Host Agreement
            const sentAgrCtx = document.getElementById('sentiment-agreement-chart').getContext('2d');
            charts.sentimentAgreement = new Chart(sentAgrCtx, {
                type: 'bar',
                data: {
                    labels: ['Negative', 'Positive', 'Neutral'],
                    datasets: [
                        {
                            label: 'Host Agrees',
                            data: [
                                sentimentAgreement.negative.agrees,
                                sentimentAgreement.positive.agrees,
                                sentimentAgreement.neutral.agrees
                            ],
                            backgroundColor: '#000'
                        },
                        {
                            label: 'Host Disagrees',
                            data: [
                                sentimentAgreement.negative.disagrees,
                                sentimentAgreement.positive.disagrees,
                                sentimentAgreement.neutral.disagrees
                            ],
                            backgroundColor: '#ccc'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: { y: { beginAtZero: true } }
                }
            });

            // 4. Confidence by Sentiment
            const sentConfCtx = document.getElementById('sentiment-confidence-chart').getContext('2d');
            charts.sentimentConfidence = new Chart(sentConfCtx, {
                type: 'bar',
                data: {
                    labels: ['Negative', 'Positive', 'Neutral'],
                    datasets: [
                        {
                            label: 'High Confidence',
                            data: [
                                sentimentConfidence.negative.high,
                                sentimentConfidence.positive.high,
                                sentimentConfidence.neutral.high
                            ],
                            backgroundColor: '#000'
                        },
                        {
                            label: 'Medium Confidence',
                            data: [
                                sentimentConfidence.negative.medium,
                                sentimentConfidence.positive.medium,
                                sentimentConfidence.neutral.medium
                            ],
                            backgroundColor: '#808080'
                        },
                        {
                            label: 'Low Confidence',
                            data: [
                                sentimentConfidence.negative.low,
                                sentimentConfidence.positive.low,
                                sentimentConfidence.neutral.low
                            ],
                            backgroundColor: '#d9d9d9'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true, beginAtZero: true }
                    }
                }
            });
        }

        function populateTopicFilter() {
            const topics = new Set();
            allData.videos.forEach(video => {
                const primary = video.models['GPT+Whisper'];
                if (primary && primary.tags) {
                    primary.tags.forEach(tag => topics.add(tag));
                }
            });

            const select = document.getElementById('filter-topic');
            Array.from(topics).sort().forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                select.appendChild(option);
            });
        }

        function filterData() {
            const activeBtn = document.querySelector('.filter-btn.active');
            const agreementFilter = activeBtn ? activeBtn.dataset.filter : 'all';
            const topicFilter = document.getElementById('filter-topic').value;
            const searchText = document.getElementById('search-input').value.toLowerCase();

            filteredData = allData.videos.filter(video => {
                // Agreement filter
                if (agreementFilter !== 'all') {
                    const agreements = Object.values(video.models).map(m => m.host_agrees);
                    const agreeCount = agreements.filter(a => a === true).length;
                    const total = agreements.length;

                    if (agreementFilter === 'full' && agreeCount !== total && agreeCount !== 0) return false;
                    if (agreementFilter === 'majority' && agreeCount !== 3) return false;
                    if (agreementFilter === 'split' && agreeCount !== 2) return false;
                }

                // Topic filter
                if (topicFilter !== 'all') {
                    const primary = video.models['GPT+Whisper'];
                    if (!primary || !primary.tags || !primary.tags.includes(topicFilter)) return false;
                }

                // Search filter
                if (searchText) {
                    const primary = video.models['GPT+Whisper'];
                    if (!primary || !primary.take.toLowerCase().includes(searchText)) return false;
                }

                return true;
            });

            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('table-body');
            if (!filteredData.length && allData) {
                filteredData = allData.videos;
            }

            if (!filteredData.length) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px;">No results found</td></tr>';
                return;
            }

            tbody.innerHTML = filteredData.slice(0, 100).map(video => {
                const models = ['GPT+Whisper', 'Gemma+Whisper', 'GPT Vision', 'GPT Transcript'];
                const primary = video.models['GPT+Whisper'] || Object.values(video.models)[0];

                if (!primary) return '';

                const modelCells = models.map(name => {
                    const model = video.models[name];
                    if (!model) return '<td>-</td>';
                    const symbol = model.host_agrees ? '✓' : '✗';
                    const cssClass = model.host_agrees ? 'agree' : 'disagree';

                    // Show host_comment as small text under the symbol with better styling
                    const commentPreview = model.host_comment
                        ? `<br><span style="font-size: 9px; color: #888; line-height: 1.3; display: block; margin-top: 3px; max-width: 80px; word-wrap: break-word;">${model.host_comment.substring(0, 35)}${model.host_comment.length > 35 ? '...' : ''}</span>`
                        : '';

                    // Build host comment section - always show it in tooltip
                    const hostCommentSection = model.host_comment
                        ? `<br><br><div style="background: ${model.host_agrees ? '#e8f5e9' : '#fff3cd'}; padding: 8px 12px; border-left: 3px solid ${model.host_agrees ? '#4caf50' : '#856404'}; margin-top: 8px; border-radius: 3px;"><strong>Host Comment:</strong><br><em>${model.host_comment}</em></div>`
                        : '';

                    const agreeText = model.host_agrees
                        ? '<span style="color: #000; font-weight: bold;">✓ Host AGREES</span>'
                        : '<span style="color: #999; font-weight: bold;">✗ Host DISAGREES</span>';

                    const tooltipText = `<div style="padding: 8px;"><strong style="font-size: 14px;">${name}</strong><br><br>${agreeText}${hostCommentSection}<br><br><strong>Take:</strong><br>"${model.take}"<br><br><strong>Speaker:</strong> ${model.speaker}<br><strong>Confidence:</strong> ${model.confidence}<br><strong>Sentiment:</strong> ${model.sentiment || 'N/A'}</div>`;
                    return `<td><span class="model-response ${cssClass}" data-tippy-content="${tooltipText.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}" data-tippy-theme="light">${symbol}${commentPreview}</span></td>`;
                }).join('');

                const tags = primary.tags.slice(0, 5).map(tag =>
                    `<span class="tag">${tag}</span>`
                ).join('');

                // Contact sheet image
                const contactSheetPath = `images/contact_sheets/${video.id}.jpg`;
                const contactSheetImg = `<img src="${contactSheetPath}" alt="Contact sheet" class="contact-sheet-thumb" onclick="openVideoModal('${video.id}')" onerror="this.style.display='none'">`;

                const duration = video.duration_formatted || '-';

                return `
                    <tr>
                        <td>${contactSheetImg}</td>
                        <td>
                            <a href="https://www.youtube.com/shorts/${video.id}" target="_blank" class="video-link">▶ Watch</a>
                            <div style="font-size: 11px; color: #666; margin-top: 4px;">${duration}</div>
                        </td>
                        <td style="max-width: 400px;">${primary.take}</td>
                        ${modelCells}
                        <td style="max-width: 150px;"><div class="tags">${tags}</div></td>
                    </tr>
                `;
            }).join('');

            // Initialize Tippy tooltips for model responses
            setTimeout(() => {
                tippy('[data-tippy-content]', {
                    allowHTML: true,
                    theme: 'light',
                    placement: 'top',
                    maxWidth: 400,
                    interactive: false
                });
            }, 100);
        }

        // Modal functions
        function openVideoModal(videoId) {
            const video = allData.videos.find(v => v.id === videoId);
            if (!video) return;

            const modal = document.getElementById('videoModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            // Set title
            modalTitle.textContent = `Video: ${videoId}`;

            // Build modal content
            let content = `
                <img src="images/contact_sheets/${videoId}.jpg" alt="Contact sheet" class="modal-image" onerror="this.style.display='none'">

                <div class="modal-section">
                    <h4>Video Link</h4>
                    <p><a href="https://www.youtube.com/shorts/${videoId}" target="_blank">Watch on YouTube →</a></p>
                </div>

                <div class="modal-section">
                    <h4>Model Responses</h4>
                    <div class="model-responses-grid">
            `;

            // Add each model's response
            const models = ['GPT+Whisper', 'Gemma+Whisper', 'GPT Vision', 'GPT Transcript'];
            models.forEach(modelName => {
                if (video.models[modelName]) {
                    const response = video.models[modelName];
                    content += `
                        <div class="model-response">
                            <h5>${modelName}</h5>
                            <div class="json-display">${JSON.stringify(response, null, 2)}</div>
                        </div>
                    `;
                }
            });

            content += `
                    </div>
                </div>`;

            modalBody.innerHTML = content;
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('videoModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function (event) {
            const modal = document.getElementById('videoModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // Event listeners for filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                // Trigger filter
                filterData();
            });
        });

        document.getElementById('filter-topic').addEventListener('change', filterData);
        document.getElementById('search-input').addEventListener('input', filterData);

        // Event listeners for model toggle buttons
        document.querySelectorAll('[data-model]').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all model buttons
                document.querySelectorAll('[data-model]').forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                // Update selected model
                selectedModel = this.dataset.model;

                // Fade out all chart grids and word cloud
                const chartGrids = document.querySelectorAll('.charts-grid');
                const wordCloud = document.getElementById('word-cloud');
                chartGrids.forEach(grid => grid.classList.add('fade-out'));
                if (wordCloud) wordCloud.classList.add('fade-out');

                // Wait for fade out animation, then update charts and table, then fade in
                setTimeout(() => {
                    renderCharts();
                    renderTopicTable();
                    // Small delay to ensure charts are rendered before fading in
                    setTimeout(() => {
                        chartGrids.forEach(grid => grid.classList.remove('fade-out'));
                        if (wordCloud) wordCloud.classList.remove('fade-out');
                    }, 50);
                }, 300); // Match CSS transition duration
            });
        });
    </script>

    <!-- Modal -->
    <div id="videoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Video Details</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be dynamically inserted -->
            </div>
        </div>
    </div>

</body>

</html>